<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Mermaid Live Editor</title>
    <link rel="stylesheet" href="/src/styles.css" />
  </head>
  <body>
    <div class="bg"></div>
    <main class="app">
      <header class="hero">
        <div>
          <p class="eyebrow">AI Mermaid Live Editor</p>
          <h1>Design, render, and patch Mermaid diagrams in one place.</h1>
          <p class="subhead">Live render, diff previews, share links, and exports. Local-first.</p>
        </div>
        <div class="hero-actions">
          <button id="help" class="ghost" type="button">Shortcuts</button>
          <button id="theme-toggle" class="ghost" type="button">Toggle theme</button>
          <button id="copy-link" type="button">Copy share link</button>
        </div>
      </header>

      <section class="workspace" id="workspace-start">
        <div class="panel template-panel">
          <div class="panel-head">
            <div>
              <h2>Starter templates</h2>
              <div class="hint">Pick a proven structure, then customize it.</div>
            </div>
            <div class="template-search">
              <input id="template-search" type="search" placeholder="Search templates" />
            </div>
          </div>
          <div id="template-filters" class="template-filters"></div>
          <div id="template-grid" class="template-grid"></div>
          <div id="template-empty" class="hint" hidden>No templates match your search.</div>
        </div>
      </section>

      <section class="workspace" id="workspace-editor">
        <div class="panel" id="editor-panel">
          <div class="panel-head">
            <h2>Mermaid editor</h2>
            <div class="hint">Live render with inline errors. Ctrl/Cmd + Enter to apply patch.</div>
          </div>
          <textarea id="editor" spellcheck="false"></textarea>
          <div class="toolbar">
            <button id="commit" type="button">Commit snapshot</button>
            <button id="export-svg" class="ghost" type="button">Export SVG</button>
            <button id="export-png" class="ghost" type="button">Export PNG</button>
            <button id="copy-source" class="ghost" type="button">Copy Mermaid</button>
            <button id="copy-svg" class="ghost" type="button">Copy SVG</button>
            <button id="copy-png" class="ghost" type="button">Copy PNG</button>
          </div>
          <div class="stats" id="stats"></div>
        </div>

        <div class="panel" id="render-panel">
          <div class="panel-head">
            <div>
              <h2>Live render</h2>
              <div class="hint" id="render-status" role="status" aria-live="polite" aria-atomic="true">Ready</div>
            </div>
            <div class="render-actions">
              <button id="render-now" class="ghost" type="button">Render now</button>
              <button id="focus-toggle" class="ghost" type="button" aria-pressed="false">Focus</button>
            </div>
          </div>
          <div class="render-toolbar">
            <div class="zoom-controls">
              <button id="zoom-out" class="ghost" type="button" aria-label="Zoom out">−</button>
              <span id="zoom-label" class="hint">100%</span>
              <button id="zoom-in" class="ghost" type="button" aria-label="Zoom in">+</button>
              <button id="zoom-reset" class="ghost" type="button">Reset</button>
            </div>
          </div>
          <div id="preview" class="preview">
            <div id="preview-content" class="preview-content"></div>
          </div>
          <div class="render-exports">
            <div id="export-summary" class="hint">Export summary updates after render.</div>
            <div class="toolbar">
              <button data-action="export-svg" class="ghost" type="button">Export SVG</button>
              <button data-action="export-png" class="ghost" type="button">Export PNG</button>
              <button data-action="copy-svg" class="ghost" type="button">Copy SVG</button>
              <button data-action="copy-png" class="ghost" type="button">Copy PNG</button>
            </div>
          </div>
        </div>
      </section>

      <section class="workspace" id="workspace-ai">
        <div class="panel">
          <div class="panel-head">
            <h2>AI patch studio</h2>
            <div class="hint">Paste or generate patch proposals, then apply with preview.</div>
          </div>
          <div class="label">Prompt recipes</div>
          <div id="prompt-recipes" class="prompt-recipes"></div>
          <label class="label" for="instructions">Instructions</label>
          <textarea id="instructions" placeholder="Refactor the flow into swimlanes with explicit approvals."></textarea>
          <div class="toolbar">
            <button id="simulate" type="button">Simulate AI patch</button>
            <button id="apply-patch" class="ghost" type="button">Apply patch</button>
          </div>
          <label class="label" for="proposal">Patch proposal</label>
          <textarea id="proposal" placeholder="AI patch output will appear here."></textarea>
        </div>

        <div class="panel">
          <div class="panel-head">
            <h2>Diff preview</h2>
            <div class="hint">Line diff between current and proposed diagram.</div>
          </div>
          <div id="diff" class="diff"></div>
        </div>
      </section>

      <section class="workspace" id="workspace-ops">
        <div class="panel">
          <div class="panel-head">
            <h2>Commit timeline</h2>
            <div class="hint">Snapshots are stored locally in your browser.</div>
          </div>
          <div id="timeline" class="timeline"></div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <h2>Quick actions</h2>
          </div>
          <div class="quick-actions">
            <button id="reset" class="ghost" type="button">Reset to starter</button>
            <button id="clear-history" class="ghost" type="button">Clear history</button>
            <button id="download-history" type="button">Download history JSON</button>
            <button id="restore-draft" class="ghost" type="button">Restore draft</button>
            <button id="clear-draft" class="ghost" type="button">Clear draft</button>
            <button id="download-source" class="ghost" type="button">Download Mermaid</button>
            <div class="export-controls">
              <div class="label">Export settings</div>
              <label class="field">
                <span>Preset</span>
                <select id="export-preset">
                  <option value="default">Default</option>
                </select>
              </label>
              <label class="field">
                <span>Preset name</span>
                <input id="export-preset-name" type="text" maxlength="40" placeholder="e.g. Blog hero" />
              </label>
              <div class="toolbar">
                <button id="save-preset" class="ghost" type="button">Save preset</button>
                <button id="delete-preset" class="ghost" type="button">Delete preset</button>
              </div>
              <label class="field">
                <span>PNG scale</span>
                <select id="export-scale">
                  <option value="1">1x</option>
                  <option value="1.5">1.5x</option>
                  <option value="2">2x</option>
                  <option value="3">3x</option>
                </select>
              </label>
              <label class="field">
                <span>Export width</span>
                <select id="export-width">
                  <option value="auto">Auto</option>
                  <option value="640">Small (640px)</option>
                  <option value="960">Medium (960px)</option>
                  <option value="1280">Large (1280px)</option>
                  <option value="custom">Custom…</option>
                </select>
              </label>
              <label class="field">
                <span>Custom width</span>
                <input id="export-width-custom" type="number" min="200" max="4000" step="50" placeholder="e.g. 1440" />
              </label>
              <label class="field checkbox">
                <input id="export-transparent" type="checkbox" />
                <span>Transparent PNG</span>
              </label>
              <label class="field">
                <span>SVG scale</span>
                <select id="export-svg-scale">
                  <option value="1">1x</option>
                  <option value="1.5">1.5x</option>
                  <option value="2">2x</option>
                </select>
              </label>
              <label class="field checkbox">
                <input id="export-svg-inline" type="checkbox" />
                <span>Inline SVG styles</span>
              </label>
              <label class="field checkbox">
                <input id="export-svg-minify" type="checkbox" />
                <span>Minify SVG</span>
              </label>
            </div>
            <div class="export-history">
              <div class="label">Recent exports</div>
              <div id="export-history" class="hint">No exports yet.</div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <dialog id="shortcuts-dialog" class="dialog" aria-labelledby="shortcuts-title">
      <div class="dialog-head">
        <h2 id="shortcuts-title">Keyboard shortcuts</h2>
        <button id="shortcuts-close" class="ghost" type="button">Close</button>
      </div>
      <div class="dialog-body">
        <div class="shortcut-row">
          <kbd>Ctrl</kbd>/<kbd>Cmd</kbd> + <kbd>Enter</kbd>
          <span>Apply patch</span>
        </div>
        <div class="shortcut-row">
          <kbd>Ctrl</kbd>/<kbd>Cmd</kbd> + <kbd>S</kbd>
          <span>Commit snapshot</span>
        </div>
        <div class="shortcut-row">
          <kbd>?</kbd>
          <span>Open shortcuts</span>
        </div>
        <div class="shortcut-row">
          <kbd>F</kbd>
          <span>Toggle focus mode</span>
        </div>
        <div class="shortcut-row">
          <kbd>Esc</kbd>
          <span>Exit focus mode</span>
        </div>
        <p class="hint">Shortcuts work from anywhere; Ctrl/Cmd + S overrides the browser save dialog.</p>
      </div>
    </dialog>

    <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true" hidden></div>

    <script type="module" src="/src/main.js"></script>
  </body>
</html>
